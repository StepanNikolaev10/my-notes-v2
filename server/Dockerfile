# Установка версии ноды
FROM node:20-alpine
# Установка зависимостей в контейнер, они потом улетят в анонимный том, это нужно что бы они не брались с локальной папки, т.к могу разные на некоторых операционках
WORKDIR /usr/src/app
COPY ./server/package*.json .
RUN npm install
# Сначала server т.к он более тяжелый, не будет заметно изменений по времени от находящегося ниже shared при пересборке контейнера из за иземенений в server
WORKDIR /usr/src/app
COPY ./server .
# Если бы shared был выше то при сборке обновлялся бы и server который более тяжелый, даже если там не было изменений.
WORKDIR /usr/src/shared
COPY ./shared .
# Возврат в директорию с app для старта
WORKDIR /usr/src/app
# Рекомендумый порт
EXPOSE 3000
# Команда старта
CMD ["npm", "run", "start:dev"]